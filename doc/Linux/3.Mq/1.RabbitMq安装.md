# RabbitMq安装



## 1 RabbitMQ单点安装

### 1.1 环境

> Linux：centos 7
>
> Erlang：22.0.x
>
> RabbitMQ：rabbitmq-server-3.7.x

### 1.2 配置yum源

打开/etc/yum.repos.d/CentOS-Base.repo，在结尾增加如下数据。

```shell
[rabbitmq-erlang]
name=rabbitmq-erlang
baseurl=https://dl.bintray.com/rabbitmq-erlang/rpm/erlang/22/el/7
gpgcheck=1
gpgkey=https://dl.bintray.com/rabbitmq/Keys/rabbitmq-release-signing-key.asc
repo_gpgcheck=0
enabled=1

[bintray-rabbitmq-server]
name=bintray-rabbitmq-rpm
baseurl=https://dl.bintray.com/rabbitmq/rpm/rabbitmq-server/v3.7.x/el/7/
gpgcheck=0
repo_gpgcheck=0
enabled=1
```

### 1.3 安装依赖包

```shell
yum install build-essential openssl openssl-develunixODBCunixODBC-devel make gccgcc-c++ kernel-devel m4 ncurses-develtktcxz
```
* build-essential 的作用  
* openssl 的作用
* openssl-develunixODBCunixODBC-devel 的作用
* 为什么要进行编译？

### 1.4 安装服务命令

```shell
yum makecache  // 这个是干什么的？
yum install rabbitmq-server
```

### 1.5 配置文件

```shell
vim /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.5/ebin/rabbit.app
```

比如修改密码、配置等等，例如：loopback_users中的<<"guest">>，只保留guest。

### 1.6 安装管理插件

```shell
rabbitmq-plugins enable rabbitmq_management
```

访问地址：http://本地ip:15672/

### 1.7 服务指令

> 服务启动

```shell
systemctl start rabbitmq-server #Centos7
service rabbitmq-server start #Centos6
```

> 开机自启

```SHELL
systemctl enable rabbitmq-server #Centos7
service rabbitmq-server enable #Centos6
```

> 服务停止

```shell
rabbitmqctl stop_app
```

------

> 添加admin用户

```shell
rabbitmqctl add_user admin admin
```

> 用户授权

```shell
rabbitmqctl set_permissions -p "/" admin ".*" ".*" ".*"
```

> 修改用户角色为管理员角色

```shell
rabbitmqctl set_user_tags admin administrator
```

> 查看用户

```shell
rabbitmqctl list_permissions
```

------

> 查看有没有rabbit进程

```shell
ps -ef | grep rabbit
```

> 查看端口有没有开放

```shell
lsof -i:5672
```

## 2 RabbitMQ集群安装

### 2.1 环境

> Linux：centos 7
>
> Erlang：22.0.x
>
> RabbitMQ：rabbitmq-server-3.7.x

